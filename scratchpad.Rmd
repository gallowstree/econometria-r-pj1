---
title: "R Notebook"
output: html_notebook
---

```{r}
summary(read.csv("test.csv"))

```

# Prioridades
1.DONE Generar predicciones rápidamente para tener un baseline con qué comparar el modelo
1.DONE Incluir age
2. Tratar outliers -> get some quick features
2. scaling
2. DONE k-folds
   ditch 3 way split, use 80/20
2.5 selection techniques
2.5. Más Feature Engineering
3. regularización
3. residual plot
4. check for heteroskedasticity

when having spare tries: compare binning age with age

# Ideas y cosas
- probar un submission con todo el train set vs train/validation
- Generalized linear model
- regression techniques for lat/long data
- split income in buckets
- median house value of neighbors?


# Interesting bits of info
- The Log Transform is one of the most popular Transformation techniques out there. It is primarily used to convert a skewed distribution to a normal distribution/less-skewed distribution.
- knn imputation is a thing\
- Normalization can be dramatically affected by outliner data while standardization handles outliers very well.Fact check this


## outlier treatment
total_rooms, total bedrooms, population (?), households (?), median-income, mhvalue

#################### 

Posiblemente será útil más adelante tener features obtenidas aplicando binning a ciertas variables.


TODOS: dividir en bins
- housing age -> 5 o 10 años
- improve info out of lat y long (google regression with lat/long data)
- pop tmaibén tiene muchos outliers... pop/households

Feature ideas:
- median income per capita
- 

```{r}

all_data$age_binned_5<-cut(all_data$housing_median_age, breaks = c(0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55), labels = F)
#summary(all_data$age_binned_5)

all_data$age_binned_10<-cut(all_data$housing_median_age, breaks = c(0, 10, 20, 30, 40, 50, 60), labels = F)

cols<-all_data %>% select(age_binned_5, age_binned_10, median_house_value)
corrplot( cor(cols),
  method = "ellipse", 
         type="full",
        addCoef.col = rgb(0,0,0, alpha = 0.6), diag = TRUE, number.cex=0.77, 
        col= colorRampPalette(c("red","white", "green"))(100))
```


### 70 15 15
> rmse(predict(fit1, new), data$validate$median_house_value)*10000
[1] 84630.61
> rmse(predict(fit2, new), data$validate$median_house_value)*10000
[1] 77402.96
> rmse(predict(fit3, new), data$validate$median_house_value)*10000
[1] 77398.13

### 85 15

> new<-data.frame(x1=data$validate$median_income, x2=data$validate$enc_ocean_proximity, x3=data$validate$total_rooms)
> 
> rmse(predict(fit1, new), data$validate$median_house_value)*10000
[1] 84646.03
> rmse(predict(fit2, new), data$validate$median_house_value)*10000
[1] 77423.86
> rmse(predict(fit3, new), data$validate$median_house_value)*10000
[1] 77418.53




######### 70 15 15

> extract_xs<-function(df) {
+   return(data.frame(x1=df$median_income, x2=df$enc_ocean_proximity, x3=df$total_rooms, x4=df$latitude, x5=df$longitude))
+ }
> 
> xs<-extract_xs(data$validate)
> 
> rmse(predict(fit1, xs), data$validate$median_house_value)*10000
[1] 84630.61
> rmse(predict(fit2, xs), data$validate$median_house_value)*10000
[1] 77402.96
> rmse(predict(fit3, xs), data$validate$median_house_value)*10000
[1] 77398.13
> rmse(predict(fit4, xs), data$validate$median_house_value)*10000
[1] 76516.55
> rmse(predict(fit5, xs), data$validate$median_house_value)*10000
[1] 73851.07


> rmse(predict(fit8,  xs_with_extras), data$validate$median_house_value)*median_house_value_scale
[1] 71356.62
> rmse(predict(fit9,  xs_with_extras), data$validate$median_house_value)*median_house_value_scale
[1] 69319.22
> rmse(predict(fit10, xs_with_extras), data$validate$median_house_value)*median_house_value_scale
[1] 66881.95
> rmse(predict(fit11, xs_with_extras), data$validate$median_house_value)*median_house_value_scale
[1] 66844.3
> 


###### 80 20 ditch 3-way partition
> rmse(predict(fit7, xs), data$validate$median_house_value)*median_house_value_scale
[1] 71770.85
> 
> rmse(predict(fit8,  xs_with_extras), data$validate$median_house_value)*median_house_value_scale
[1] 71466.84
> rmse(predict(fit9,  xs_with_extras), data$validate$median_house_value)*median_house_value_scale
[1] 69383.31
> rmse(predict(fit10, xs_with_extras), data$validate$median_house_value)*median_house_value_scale
[1] 66967.63
> rmse(predict(fit11, xs_with_extras), data$validate$median_house_value)*median_house_value_scale
[1] 66920.66

